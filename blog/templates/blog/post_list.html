{% extends 'blog/base.html' %}

{% block title %}Posts | TuPrimeraPagina{% endblock %}

{% block content %}
<h2>Posts</h2>


<form method="get" class="mb-3 d-flex gap-2">
  <input class="form-control" type="search" name="q"
         value="{{ request.GET.q }}"
         placeholder="Buscar por título o contenido">
  <button class="btn btn-primary" type="submit">Buscar</button>
  {% if request.GET.q %}
    <a class="btn btn-outline-secondary" href="{{ request.path }}">Limpiar</a>
  {% endif %}
</form>

{% if messages %}
  {% for m in messages %}
    <div class="alert alert-{{ m.tags|default:'info' }} mb-3">{{ m }}</div>
  {% endfor %}
{% endif %}

{% if user.is_authenticated %}
  <div class="mb-3">
    <a class="btn btn-success" href="{% url 'post_create' %}">+ Nuevo Post</a>
  </div>
{% endif %}

{% if posts %}
  <ul class="list-group">
    {% for p in posts %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <a href="{% url 'post_detail' p.slug %}">{{ p.title }}</a><br>
          <small class="text-muted">
            {{ p.created_at|date:"d/m/Y H:i" }}
          </small>
        </div>

        {% if user.is_authenticated %}
        <div class="btn-group btn-group-sm">
          <a class="btn btn-outline-secondary" href="{% url 'post_update' p.slug %}">Editar</a>
          <a class="btn btn-outline-danger" href="{% url 'post_delete' p.slug %}">Borrar</a>
        </div>
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  {% if is_paginated %}
  <nav class="mt-3">
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">&laquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
      {% endif %}

      {% for num in paginator.page_range %}
        {% if num == page_obj.number %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% else %}
          <li class="page-item">
            <a class="page-link" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">&raquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
{% else %}
  <p>No hay posts todavía. Crealos desde <a href="/admin/">admin</a>.</p>
{% endif %}
{% endblock %}

